# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Данные и типы данных, используемые в приложении. 
  
  Товар
```
  interface IProduct {
    id: string; - идентификатор продукта
    description: string; - описание продукта
    image: string; - урл на картинку
    title: string; - название продукта
    category: ProductCategory; - категория продукта
    price: number; - цена продукта
}
```

  Заказ
```
  interface IOrder {
    payment: OrderPayment; - тип оплаты
    email: string; - email покупателя
    phone: string; - телефон покупателя
    address: string; - адрес покупателя
    total: number; - сумма заказа
    errors: FormErrors; - ошибки формы
}
```
  Интерфейс для модели данных товара
```
  interface IProductData {
  items: IProduct[];
  preview: string | null;
  getProduct(productId: string): IProduct;
}
```
  Данные товара, используемые на главной странице
```
  type TProductInfo = Pick<IProduct,  'image' | 'title' | 'category' | 'price'>
```
  Данные товара, используемые при просмотре карточки товара
```
  type TProductModalInfo = Pick<IProduct, 'description' | 'image' | 'title' | 'category' | 'price'>
```
  Данные заказа, используемые в форме при выборе способа оплаты и указание адреса покупателя
```
  type TOrderModalPaymentAddress = Pick<IOrder, 'payment' | 'address'>
```
  Данные заказа, используемые в форме для указание емейла и телефона покупателя
```
  type TOrderModalEmailPhone = Pick<IOrder, 'email' | 'phone'>
```
  Данные заказа, используемые в корзине 
```
  type TBasket = Pick<IOrder, 'items' | 'total'>
```
  Категория продукта
```
    enum ProductCategory {
    'софт-скил' = 'soft',
    'другое' = 'other',
    'хард-скил' = 'hard',
    'дополнительное' = 'additional',
    'кнопка' = 'button'
}
```
  Тип оплаты
```
    type OrderPayment = 'card' | 'cash'
```

## Архитерктура приложения  

 Код приложения разделен на слои согласно парадигме MVP:

 - слой представления, отвечает за отображение данных на странице
 - слой данных, отвечает за хранение и изменение данных
 - презентер, отвечает за связь представления и данных

### Базовый код

#### Класс API

Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. Методы:

- `get(uri: string)` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер

- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

- `handleResponse(response: Response)` - защищенный метод, в случае успеха выполнения запроса возвращает объект в виде json. В случае неуспеха - статус и текст ошибки. Принимает в параметрах Response

#### Класс EventEmmiter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.

 Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

  - `on(eventName: EventName, callback: (event: T) => void)` - Установить обработчик на событие

  - `off(eventName: EventName, callback: Subscriber)` - Снять обработчик с события

  - `emit(eventName: string, data?: T)` - Инициировать событие с данными

  - `onAll(callback: (event: EmitterEvent) => void)` - Слушать все события

  - `offAll()` - Сбросить все обработчики

  - `trigger(eventName: string, context?: Partial<T>)` - Сделать коллбек триггер, генерирующий событие при вызове


### Слой данных

#### Класс ProductsData

Класс отвечает за хранение и логику работы с данными карточки товара.

Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- `_items: IProduct []` - массив объектов карточек
- `_preview: string | null` - id продукта, выбранный для просмотра в модальной окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.


Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `getProduct(productId: string): IProduct;` - возвращает карточку по ее id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс OrderData

Класс отвечает за хранение и логику работы с данными заказа.

Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- `getOrderInfo(): IOrder;` - возвращает основные данные о заказе
-  `setOrderInfo(userData: IOrder): void;` - сохраняет данные о заказе
-  `checkUserValidation(data: Record<keyof TUser, string>):boolean;` - проверяет объект с данными пользователя на валидность


#### Класс BasketData

Класс отвечает за хранение и логику работы корзины.

Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- `total: IProduct ['price'];`  - свойство с массивом цен товаров для подсчета итоговой суммы
- `items: IProduct ['id'];` - свойство с массивом айди товаров для отображения в корзине

Так же класс предоставляет набор методов для взаимодействия с этими данными и даннами интерфейса `IProduct`.

- `addProduct(product: IProduct): void;` - добавляет продукт в корзину
- `deleteProduct(productId: string, playload: null): void;` -  удаляет продукт из корзины

## Классы представления

Все классы представления отвечают за отображение внутри контейнера (Dom-элемент) передаваемых в них данных.

#### Класс Modal

  Реализует модальное окно. Так же предоставляет методы `open`, `close` для управления отображением модального окна. Устанавливает слушатель для закрытия модального окна по клику на оверлей и кноку-крестик для закрытия попапа.

  `constructor(selector: string, events: IEvents)` Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.


  Поля класса:

  - `submitButton: HTMLButtonElement` - кнопка подтверждения
  - `_form: HTMLFormElement` - элемент формы
  - `modal: HTMLElement` - элемент модального окна
  - `events: IEvents` - брокер событий
  - `formName: string` - значение атрибута name формы
  - `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы
  - `errors: Record<string, HTMLElement>` - объект, хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов
  - `imageElement: HTMLImageElemet` - элемент разметки с изображением
  - `imageTitle: HTMLElement` - элемент разметки для вывода названия краточки
  - `imageDescr: HTMLElement` - элемент разметки для вывода описания карточки
  - `imagePrice: HTMLElement` - элемент разметки для вывода цены товара карточки
  - `imageCategory: HTMLElement` - элемент разметки для вывода категории товара карточки

Методы:

- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError(field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанными полем ввода
- `hideInputError(field: string): void` - очищает текст ошибки под указанным полем ввода
- `close(): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- `open(data: { title: string, image: string, price: number, description: string, category: string }): void` - метод, принимающий данные краточки, которые используются для заполнения атрибутов элементов модального окна
-  `get form: HTMLElement` - геттер для получения элемента формы

#### Класс Product

Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми, пользователем генерируются соответствующие события.

Методы:
- `setData(productData: IProduct, productID: string): void` - заполняет атрибуты элементов карточки данными.
- `геттер id` возвращает уникальный id карточки

#### Класс ProductsContainer

Отвечает за отображение блока с карточками товаров на главной странице. В конструктор принимает контейнер, в котором размещаются карточки

### Слой коммуникации

#### Класс AppApi

 Принимает в конструктор экземпляр класса API и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

 Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера. 

 Взаимодействие осуществляется за счет событий генерируемых с поомщью брокера событий и обработчиков этих событий, описанных в `index.ts`

 В  `index.ts` сначала создаются экземпляры всех необходимых классов,  а затем настраивается обработка событий.

Основные события

`products: changed` - изменение списка товаров\
`basket: add-product` - добавление товара в корзину\
`basket: remove-product` - удаление товара из корзины\
`basket: create-order` - оформление заказа\
`basket: open` - открытие корзины пользователя\
`product: preview` - открытие модалки с товаром\
`form: errors-changed` - показ(скрытие) ошибок формы\
`order: open` - открытие формы заказа\
`order: clear` - очистка формы заказа\
`order: set-payment-type` - выбор типа оплаты\
`modal: open` - открытие модалки\
`modal: close` - закрытие модалки