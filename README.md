# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении. 

  Товар
```
  interface IProduct {
    id: string; - идентификатор продукта
    description: string; - описание продукта
    image: string; - урл на картинку
    title: string; - название продукта
    category: ProductCategory; - категория продукта
    price: number; - цена продукта
}
```

  Заказ
```
  interface IOrder {
    payment: OrderPayment; - тип оплаты
    email: string; - email покупателя
    phone: string; - телефон покупателя
    address: string; - адрес покупателя
    total: number; - сумма заказа
    errors: FormErrors; - ошибки формы
}
```
  Интерфейс для модели данных товара
```
  interface IProductData {
  items: IProduct[];
  preview: string | null;
  getProduct(productId: string): IProduct;
}
```
  Данные товара, используемые на главной странице
```
  type TProductInfo = Pick<IProduct,  'image' | 'title' | 'category' | 'price'>
```
  Данные товара, используемые при просмотре карточки товара
```
  type TProductModalInfo = Pick<IProduct, 'description' | 'image' | 'title' | 'category' | 'price'>
```
  Данные заказа, используемые в форме при выборе способа оплаты и указание адреса покупателя
```
  type TOrderModalPaymentAddress = Pick<IOrder, 'payment' | 'address'>
```
  Данные заказа, используемые в форме для указание емейла и телефона покупателя
```
  type TOrderModalEmailPhone = Pick<IOrder, 'email' | 'phone'>
```
  Данные заказа, используемые в корзине 
```
  type TBasket = Pick<IOrder, 'items' | 'total'>
```
  Категория продукта
```
    enum ProductCategory {
    'софт-скил' = 'soft',
    'другое' = 'other',
    'хард-скил' = 'hard',
    'дополнительное' = 'additional',
    'кнопка' = 'button'
}
```
  Тип оплаты
```
    type OrderPayment = 'card' | 'cash'
```

## Архитерктура приложения  

 Код приложения разделен на слои согласно парадигме MVP:

 - слой представления, отвечает за отображение данных на странице
 - слой данных, отвечает за хранение и изменение данных
 - презентер, отвечает за связь представления и данных

### Базовый код

#### Класс API

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. Методы:

- `get(uri: string)` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер

- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

- `handleResponse(response: Response)` - защищенный метод, в случае успеха выполнения запроса возвращает объект в виде json. В случае неуспеха - статус и текст ошибки. Принимает в параметрах Response

#### Класс EventEmmiter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.

 Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

  - `on(eventName: EventName, callback: (event: T) => void)` - Установить обработчик на событие

  - `off(eventName: EventName, callback: Subscriber)` - Снять обработчик с события

  - `emit(eventName: string, data?: T)` - Инициировать событие с данными

  - `onAll(callback: (event: EmitterEvent) => void)` - Слушать все события

  - `offAll()` - Сбросить все обработчики

  - `trigger(eventName: string, context?: Partial<T>)` - Сделать коллбек триггер, генерирующий событие при вызове


#### Класс Model<T>

Абстрактный класс дженерик, обобщающий в себе конструктор и метод привязки события. 

  - `emmitChanges` — регистрирует входящее событие в `EventEmitter`

#### Класс Component<T>

Данный класс представляет собой абстрактный базовый класс для компонентов пользовательского интерфейса в веб-приложениях. Он предназначен для наследования другими классами, которые реализуют конкретные компоненты интерфейса. Класс предоставляет набор общих методов для работы с элементами DOM и их свойствами. 

Конструктор класса принимает один аргумент — элемент DOM (HTMLElement), который служит контейнером для компонента. Этот элемент становится доступным через защищенное свойство container, что позволяет дочерним классам обращаться к нему для манипуляций с DOM внутри своего контейнера.

Основные методы, реализуемые классом:

- `toggleClass` — используется для переключения CSS-класса (className) на указанном элементе DOM (element). Если третий параметр force предоставлен, то класс будет добавлен, если force истинно, и удален, если force ложно. Если force не указан, то класс будет переключен (добавлен, если отсутствует, или удален, если присутствует).

- `setDisabled` — устанавливает атрибут disabled для указанного элемента DOM (element) в зависимости от значения параметра state. Если state истинно, атрибут disabled добавляется к элементу, делая его неактивным. Если state ложно, атрибут удаляется, делая элемент активным снова.

- `setText` — устанавливает текстовое содержимое (textContent) указанного элемента DOM (element). Значение value преобразуется в строку перед присвоением.

- `setImage` — Метод setImage используется для установки источника изображения (src) и альтернативного текста (alt, необязательно) для указанного элемента изображения (HTMLImageElement). Если альтернативный текст предоставлен, он также устанавливается для элемента изображения.

- `render` — предназначен для рендеринга данных в интерфейсе компонента. Он принимает необязательный параметр data, который является частичным типом T и может использоваться для обновления свойств компонента перед рендерингом. Метод объединяет предоставленные данные с текущим состоянием компонента и возвращает контейнер компонента (this.container).


### Слой данных(Model)

#### Класс LarekApi

Представляет собой расширение абстрактного класса Api, предназначенного для взаимодействия с веб-API. Этот класс специализируется на работе с API, связанным с продуктами и заказами в контексте интернет-магазина или подобной платформы.

Конструктор класса принимает три параметра:

`cdn`: Строка, указывающая URL CDN (Content Delivery Network), которое может использоваться для загрузки статических ресурсов, таких как изображения продуктов.
`baseUrl`: Базовый URL API, к которому будут отправляться запросы.
`options`: Необязательный параметр, содержащий дополнительные настройки для запросов, такие как методы аутентификации, заголовки и т.д.
Конструктор вызывает конструктор базового класса Api с параметрами baseUrl и options, а также устанавливает свойство cdn.

Основные методы, реализуемые классом:

- `getProductList` — Отправляет GET-запрос к эндпоинту /product для получения списка продуктов. В ответе ожидается объект типа ApiListResponse<IProduct>, который содержит массив продуктов в поле items. Метод возвращает промис, который разрешается массивом продуктов, где каждый продукт является копией объекта из ответа API (создается новый объект с теми же свойствами).

- `orderProducts` — Отправляет POST-запрос к эндпоинту /order для размещения заказа. В качестве тела запроса передается объект заказа типа IOrder. Метод возвращает промис, который разрешается объектом заказа, полученным в ответе от сервера.

#### Класс AppData

Класс `AppData` наследуется от абстрактного класса Model<IAppData> и представляет собой модель данных приложения, содержащую информацию о каталоге продуктов, корзине покупок, текущем заказе пользователя и ошибках формы.

Свойства:
`catalog`: Массив продуктов, представляющих каталог магазина.
`preview`: Строка, содержащая идентификатор продукта, который в данный момент просматривается пользователем.
`basket`: Массив продуктов, добавленных в корзину покупок.
`order`: Объект заказа, содержащий информацию о текущем заказе пользователя.
`formErrors`: Объект, содержащий ошибки формы ввода данных заказа.


Методы:
`clearBasket`: Очищает корзину покупок и список товаров в заказе.
`addToOrder`: Добавляет продукт в заказ по его идентификатору.
`removeFromOrder`: Удаляет продукт из заказа по его идентификатору.
`setCatalog`: Устанавливает каталог продуктов и генерирует событие об изменении списка продуктов.
`setPreview`: Устанавливает текущий просматриваемый продукт и генерирует событие об изменении предварительного просмотра.
`setProductToBasket`: Добавляет продукт в корзину покупок.
`removeProductToBasket`: Удаляет продукт из корзины покупок.
`statusBasket`: Геттер, возвращающий true, если корзина пуста, и false в противном случае.
`bskt`: Геттер, возвращающий массив продуктов в корзине.
`total`: Сеттер для установки общей стоимости заказа.
`getTotal`: Вычисляет общую стоимость товаров в заказе.
`setOrderField и setContactsField`: Устанавливают значения полей формы заказа и проверяют их на валидность, генерируя событие, если форма прошла валидацию.
`validateOrder и validateContacts`: Проверяют валидность полей адреса и контактных данных соответственно, заполняют объект ошибок и генерируют событие об изменении ошибок формы.


#### Класс BasketData

Класс отвечает за хранение и логику работы корзины.

Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- `total: IProduct ['price'];`  - свойство с массивом цен товаров для подсчета итоговой суммы
- `items: IProduct ['id'];` - свойство с массивом айди товаров для отображения в корзине

Так же класс предоставляет набор методов для взаимодействия с этими данными и даннами интерфейса `IProduct`.

- `addProduct(product: IProduct): void;` - добавляет продукт в корзину
- `deleteProduct(productId: string, playload: null): void;` -  удаляет продукт из корзины

## Классы представления

Все классы представления отвечают за отображение внутри контейнера (Dom-элемент) передаваемых в них данных.

#### Класс Modal

  Реализует модальное окно. Так же предоставляет методы `open`, `close` для управления отображением модального окна. Устанавливает слушатель для закрытия модального окна по клику на оверлей и кноку-крестик для закрытия попапа.

  `constructor(selector: string, events: IEvents)` Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.


  Поля класса:

  - `submitButton: HTMLButtonElement` - кнопка подтверждения
  - `_form: HTMLFormElement` - элемент формы
  - `modal: HTMLElement` - элемент модального окна
  - `events: IEvents` - брокер событий
  - `formName: string` - значение атрибута name формы
  - `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы
  - `errors: Record<string, HTMLElement>` - объект, хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов
  - `imageElement: HTMLImageElemet` - элемент разметки с изображением
  - `imageTitle: HTMLElement` - элемент разметки для вывода названия краточки
  - `imageDescr: HTMLElement` - элемент разметки для вывода описания карточки
  - `imagePrice: HTMLElement` - элемент разметки для вывода цены товара карточки
  - `imageCategory: HTMLElement` - элемент разметки для вывода категории товара карточки

Методы:

- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError(field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанными полем ввода
- `hideInputError(field: string): void` - очищает текст ошибки под указанным полем ввода
- `close(): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- `open(data: { title: string, image: string, price: number, description: string, category: string }): void` - метод, принимающий данные краточки, которые используются для заполнения атрибутов элементов модального окна
-  `get form: HTMLElement` - геттер для получения элемента формы

#### Класс Product

Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми, пользователем генерируются соответствующие события.

Методы:
- `setData(productData: IProduct, productID: string): void` - заполняет атрибуты элементов карточки данными.
- `геттер id` возвращает уникальный id карточки

#### Класс ProductsContainer

Отвечает за отображение блока с карточками товаров на главной странице. В конструктор принимает контейнер, в котором размещаются карточки

### Слой коммуникации

#### Класс AppApi

 Принимает в конструктор экземпляр класса API и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

 Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера. 

 Взаимодействие осуществляется за счет событий генерируемых с поомщью брокера событий и обработчиков этих событий, описанных в `index.ts`

 В  `index.ts` сначала создаются экземпляры всех необходимых классов,  а затем настраивается обработка событий.

Основные события

`products: changed` - изменение списка товаров\
`basket: add-product` - добавление товара в корзину\
`basket: remove-product` - удаление товара из корзины\
`basket: create-order` - оформление заказа\
`basket: open` - открытие корзины пользователя\
`product: preview` - открытие модалки с товаром\
`form: errors-changed` - показ(скрытие) ошибок формы\
`order: open` - открытие формы заказа\
`order: clear` - очистка формы заказа\
`order: set-payment-type` - выбор типа оплаты\
`modal: open` - открытие модалки\
`modal: close` - закрытие модалки